<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { 
            --accent: #0284c7; 
            --bg-gradient: linear-gradient(135deg, #e0f2fe 0%, #7dd3fc 100%);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg-gradient); background-attachment: fixed; 
            margin: 0; padding: 15px; color: #0c4a6e;
            min-height: 100vh; display: flex; flex-direction: column;
        }

        .header-area {
            text-align: center; padding: 20px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px); border-radius: 20px;
            margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.4);
        }

        #siteBrief { font-size: 14px; color: #0369a1; margin-top: 5px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
        #mainCategories { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        .cat-btn { 
            background: white; border: none; padding: 35px; border-radius: 25px;
            font-size: 24px; font-weight: 900; color: #0369a1; cursor: pointer;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .cat-btn:active { transform: scale(0.95); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        #subPage { display: none; flex-grow: 1; }
        #buttonsContainer { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        
        .main-btn { 
            background: linear-gradient(to bottom, #ffffff, #e0f2fe);
            border: 1px solid #bae6fd; padding: 20px 10px; 
            border-radius: 18px; cursor: pointer; font-weight: 800; 
            color: #0369a1; box-shadow: 0 6px 0 #38bdf8, 0 10px 15px rgba(0,0,0,0.1);
            transition: all 0.1s ease; transform: translateY(-4px); font-size: 16px;
        }
        .main-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #38bdf8; }

        /* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
        .bottom-nav { margin-top: auto; padding: 20px 0; text-align: center; }
        .back-btn { background: #64748b; color: white; border: none; padding: 12px 30px; border-radius: 15px; cursor: pointer; font-weight: bold; font-size: 16px; display: none; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 5%; left: 5%; width: 90%; height: 90%; background: white; z-index: 10001; padding: 20px; border-radius: 25px; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,0.3); }
        .admin-section { background: #f1f5f9; padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 10px; box-sizing: border-box; }
        .btn-action { padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; border: none; color: white; width: 100%; margin-top: 5px; }
        .dynamic-row { display: flex; gap: 5px; margin-bottom: 8px; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 25px; border-radius: 30px; width: 85%; max-width: 400px; text-align: center; }
        #modalImg { width: 100%; border-radius: 20px; max-height: 200px; object-fit: cover; margin-bottom: 15px; display: none; }
        .info-card { text-align: right; background: #f0f9ff; padding: 15px; border-radius: 20px; }
        .info-card p { margin: 8px 0; border-bottom: 1px solid #e0f2fe; padding-bottom: 5px; }

        .admin-trigger { position: fixed; bottom: 10px; right: 10px; width: 30px; height: 30px; opacity: 0.1; cursor: pointer; z-index: 9999; }
    </style>
</head>
<body>

    <div class="header-area">
        <h1 id="mainHeading">ØªØ­Ù…ÙŠÙ„...</h1>
        <div id="siteBrief"></div>
    </div>

    <div id="mainCategories">
        <button class="cat-btn" onclick="openCategory('Ø§Ù„Ø§Ø·Ø¨Ø§Ø¡')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø§Ø·Ø¨Ø§Ø¡</button>
        <button class="cat-btn" onclick="openCategory('Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª')">ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</button>
    </div>

    <div id="subPage">
        <div id="buttonsContainer"></div>
    </div>

    <div class="bottom-nav">
        <button id="globalBackBtn" class="back-btn" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ø§Ø¨Ù‚</button>
    </div>

    <div class="admin-trigger" onclick="checkAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <div class="admin-section">
            <h4>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h4>
            <input type="text" id="siteNameInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
            <input type="text" id="siteBriefInp" placeholder="Ù†Ø¨Ø°Ø© ØµØºÙŠØ±Ø©">
            <button class="btn-action" style="background:#10b981;" onclick="saveSiteSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <div class="admin-section">
            <h4 id="formTitle">â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø³Ù…</h4>
            <input type="hidden" id="editKey">
            <label>ÙŠØªØ¨Ø¹ Ù„ØªØµÙ†ÙŠÙ:</label>
            <select id="parentCat">
                <option value="Ø§Ù„Ø§Ø·Ø¨Ø§Ø¡">Ø§Ù„Ø§Ø·Ø¨Ø§Ø¡</option>
                <option value="Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</option>
            </select>
            <input type="text" id="btnName" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="file" id="imgFile" accept="image/*">
            
            <div style="display:flex; gap:5px;">
                <input type="text" id="tStart" placeholder="Ù…Ù†" style="flex:1">
                <select id="pStart" style="flex:1"><option>ØµØ¨Ø§Ø­Ø§Ù‹</option><option>Ù…Ø³Ø§Ø¡Ù‹</option></select>
                <input type="text" id="tEnd" placeholder="Ø¥Ù„Ù‰" style="flex:1">
                <select id="pEnd" style="flex:1"><option>Ù…Ø³Ø§Ø¡Ù‹</option><option>ØµØ¨Ø§Ø­Ø§Ù‹</option></select>
            </div>

            <div id="customFields"></div>
            <button onclick="addCustomField('', '')" style="background:#6366f1; color:white; border:none; padding:8px; border-radius:8px; cursor:pointer; width:100%; margin-bottom:10px;">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ù†Ø© ÙˆØµÙ</button>

            <input type="text" id="whatsapp" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
            <button id="mainSaveBtn" class="btn-action" style="background:var(--accent);" onclick="saveToFirebase()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…</button>
            <button id="cancelEditBtn" class="btn-action" style="background:#94a3b8; display:none;" onclick="resetForm()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        </div>
        <button class="btn-action" style="background:#ef4444;" onclick="closeAdmin()">âŒ Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        <div id="manageList" style="margin-top:20px;"></div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" style="color:#0369a1; margin-top:0;"></h2>
            <img id="modalImg">
            <div id="modalDataBox" class="info-card"></div>
            <a id="modalWa" href="#" target="_blank" style="display:block; background:#25d366; color:white; text-decoration:none; padding:15px; border-radius:20px; margin:20px 0; font-weight:bold;">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</a>
            <button onclick="closeModal()" style="border:none; background:none; color:#64748b; font-weight:bold; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();

        let allData = {};
        let currentEditingImg = "";

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        rdb.ref('site_config').on('value', s => {
            const d = s.val() || {};
            document.getElementById('mainHeading').innerText = d.name || "Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ";
            document.getElementById('siteBrief').innerText = d.brief || "";
            document.getElementById('pageTitle').innerText = d.name || "Ø§Ù„ÙØ±Ù†Ø³ÙŠ";
        });

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        rdb.ref('bookings').on('value', snapshot => {
            allData = snapshot.val() || {};
            renderManageList();
        });

        function openCategory(catName) {
            document.getElementById('mainCategories').style.display = 'none';
            document.getElementById('subPage').style.display = 'block';
            document.getElementById('globalBackBtn').style.display = 'inline-block';
            
            const container = document.getElementById('buttonsContainer');
            container.innerHTML = '';

            for (let key in allData) {
                if (allData[key].parentCat === catName) {
                    const data = allData[key];
                    const b = document.createElement('button');
                    b.className = 'main-btn';
                    b.innerText = data.btnName;
                    b.onclick = () => showDetails(data);
                    container.appendChild(b);
                }
            }
        }

        function goBack() {
            document.getElementById('mainCategories').style.display = 'grid';
            document.getElementById('subPage').style.display = 'none';
            document.getElementById('globalBackBtn').style.display = 'none';
        }

        async function saveToFirebase() {
            const key = document.getElementById('editKey').value;
            const file = document.getElementById('imgFile').files[0];
            let imgToSave = currentEditingImg;

            if (file) { 
                imgToSave = await new Promise(r => { const reader = new FileReader(); reader.onload = e => r(e.target.result); reader.readAsDataURL(file); }); 
            }
            
            const fields = [];
            document.querySelectorAll('.dynamic-row').forEach(row => {
                fields.push({label: row.querySelector('.f-label').value, value: row.querySelector('.f-value').value});
            });

            const data = {
                parentCat: document.getElementById('parentCat').value,
                btnName: document.getElementById('btnName').value,
                img: imgToSave,
                whatsapp: "20" + document.getElementById('whatsapp').value.replace(/^0/, '').replace(/\s/g, ''),
                time: `Ù…Ù† ${document.getElementById('tStart').value} ${document.getElementById('pStart').value} Ø¥Ù„Ù‰ ${document.getElementById('tEnd').value} ${document.getElementById('pEnd').value}`,
                fields: fields
            };

            if (key) await rdb.ref('bookings/' + key).set(data);
            else await rdb.ref('bookings').push(data);
            
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            resetForm();
        }

        function prepareEdit(key) {
            const d = allData[key];
            document.getElementById('editKey').value = key;
            document.getElementById('parentCat').value = d.parentCat;
            document.getElementById('btnName').value = d.btnName;
            currentEditingImg = d.img || "";
            document.getElementById('whatsapp').value = d.whatsapp.replace('20', '');
            
            if(d.time) {
                const t = d.time.split(' ');
                document.getElementById('tStart').value = t[1];
                document.getElementById('pStart').value = t[2];
                document.getElementById('tEnd').value = t[4];
                document.getElementById('pEnd').value = t[5];
            }

            document.getElementById('customFields').innerHTML = '';
            if(d.fields) d.fields.forEach(f => addCustomField(f.label, f.value));

            document.getElementById('formTitle').innerText = "ğŸ“ ØªØ¹Ø¯ÙŠÙ„: " + d.btnName;
            document.getElementById('mainSaveBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            document.getElementById('cancelEditBtn').style.display = "block";
            document.getElementById('adminPanel').scrollTo(0,0);
        }

        function renderManageList() {
            const list = document.getElementById('manageList');
            list.innerHTML = '<h4>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h4>';
            for (let key in allData) {
                const d = allData[key];
                const m = document.createElement('div');
                m.style = "display:flex; justify-content:space-between; background:#fff; padding:10px; border-radius:10px; margin-bottom:5px; border:1px solid #eee; align-items:center;";
                m.innerHTML = `<span style="font-size:13px;">[${d.parentCat}] ${d.btnName}</span> 
                <div>
                    <button onclick="prepareEdit('${key}')" style="background:#eab308; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="deleteItem('${key}')" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Ø­Ø°Ù</button>
                </div>`;
                list.appendChild(m);
            }
        }

        function showDetails(d) {
            document.getElementById('modalTitle').innerText = d.btnName;
            const im = document.getElementById('modalImg');
            if(d.img) { im.src = d.img; im.style.display = 'block'; } else { im.style.display = 'none'; }
            let h = `<p>â° <b>Ø§Ù„Ù…ÙˆØ¹Ø¯:</b> ${d.time}</p>`;
            if(d.fields) d.fields.forEach(f => h += `<p><b>${f.label}:</b> ${f.value}</p>`);
            document.getElementById('modalDataBox').innerHTML = h;
            document.getElementById('modalWa').href = `https://wa.me/${d.whatsapp}`;
            document.getElementById('detailModal').style.display = 'flex';
        }

        function addCustomField(l, v) {
            const div = document.createElement('div');
            div.className = 'dynamic-row';
            div.innerHTML = `<input type="text" value="${l}" class="f-label" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" style="flex:1"><input type="text" value="${v}" class="f-value" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" style="flex:2"><button onclick="this.parentElement.remove()" style="color:red; background:none; border:none; font-weight:bold;">X</button>`;
            document.getElementById('customFields').appendChild(div);
        }

        function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "1987") { document.getElementById('adminPanel').style.display = 'block'; resetForm(); } }
        function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
        function closeModal() { document.getElementById('detailModal').style.display = 'none'; }
        function deleteItem(k) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) rdb.ref('bookings/'+k).remove(); }
        function resetForm() { 
            document.getElementById('editKey').value = ''; 
            document.getElementById('btnName').value = '';
            document.getElementById('whatsapp').value = '';
            document.getElementById('customFields').innerHTML = ''; 
            addCustomField('Ø§Ù„Ø¯ÙƒØªÙˆØ±', ''); 
            addCustomField('Ø§Ù„Ø³Ø¹Ø±', '');
            document.getElementById('formTitle').innerText = "â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯";
            document.getElementById('mainSaveBtn').innerText = "Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…";
            document.getElementById('cancelEditBtn').style.display = "none";
            currentEditingImg = "";
        }
        function saveSiteSettings() { rdb.ref('site_config').set({ name: document.getElementById('siteNameInp').value, brief: document.getElementById('siteBriefInp').value }); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!"); }
    </script>
</body>
</html>
