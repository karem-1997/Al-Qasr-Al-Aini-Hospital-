<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0284c7; --bg: #f0f9ff; --white: #ffffff; --text: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; color: var(--text); }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« */
        .top-header { 
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); 
            padding: 25px 20px; border-radius: 0 0 35px 35px; color: white; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .search-box { 
            background: white; border-radius: 50px; display: flex; align-items: center; 
            padding: 5px 15px; margin-top: 15px; max-width: 500px; margin-left: auto; margin-right: auto;
        }
        .search-box input { border: none; outline: none; width: 100%; padding: 10px; font-size: 14px; }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ø¯ÙƒØ§ØªØ±Ø© */
        .main-container { padding: 0 15px 100px 15px; }
        #pathDisplay { font-size: 13px; color: var(--primary); font-weight: bold; margin-bottom: 15px; display: block; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { 
            background: white; padding: 20px 10px; border-radius: 25px; text-align: center; 
            cursor: pointer; box-shadow: 0 6px 0 #cbd5e1; transition: 0.1s; border: 1px solid #e2e8f0;
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px;
        }
        .card:active { transform: translateY(3px); box-shadow: none; }
        .card .icon { font-size: 40px; margin-bottom: 8px; }
        .card .name { font-weight: bold; font-size: 15px; color: #0369a1; }

        /* Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ù„Ù…ÙˆØ¯Ø§Ù„) - ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { 
            background: white; width: 85%; max-width: 380px; border-radius: 35px; overflow: hidden; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header { padding: 20px; background: #f8fafc; text-align: center; border-bottom: 1px solid #eee; }
        #modalImg { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        #mTitle { margin: 0; color: #0369a1; font-size: 20px; }

        .modal-body { padding: 20px; text-align: right; max-height: 300px; overflow-y: auto; }
        .info-row { background: #f1f5f9; padding: 10px 15px; border-radius: 12px; margin-bottom: 8px; border-right: 4px solid var(--primary); }
        .info-row b { color: #475569; font-size: 13px; }
        .info-row span { display: block; color: #0f172a; font-weight: bold; font-size: 15px; margin-top: 2px; }

        .modal-footer { padding: 15px 20px 25px 20px; display: flex; flex-direction: column; gap: 10px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; font-size: 16px; }
        .btn-wa { background: #25d366; color: white; box-shadow: 0 4px 14px rgba(37, 211, 102, 0.3); }
        .btn-close { background: #f1f5f9; color: #64748b; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; z-index: 10001; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .admin-box { background: white; padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 12px; font-size: 14px; }
        
        .admin-trigger { position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px; opacity: 0.1; cursor: pointer; z-index: 10002; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 style="margin:0;">ğŸ¥ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ</h2>
        <div class="search-box">
            <span>ğŸ”</span>
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙƒØªÙˆØ±ØŒ ØªØ®ØµØµØŒ Ø£Ùˆ Ø¹ÙŠØ§Ø¯Ø©..." oninput="handleSearch()">
        </div>
    </div>

    <div class="main-container">
        <span id="pathDisplay">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        <div id="mainGrid" class="grid"></div>

        <div id="navButtons" style="display:none; margin-top:20px;">
            <button class="btn btn-close" style="background:#64748b; color:white;" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
        </div>
    </div>

    <div class="admin-trigger" onclick="openAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <h2 style="text-align:center; color:var(--primary);">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>
        
        <div class="admin-box">
            <h4>ğŸ“¦ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ©)</h4>
            <input type="hidden" id="editCatId">
            <select id="catParent"><option value="root">-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option></select>
            <input type="text" id="catName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <select id="catIcon">
                <option value="ğŸ¥">ğŸ¥ Ø¹Ø§Ù…</option><option value="ğŸ¦·">ğŸ¦· Ø£Ø³Ù†Ø§Ù†</option>
                <option value="ğŸ‘ï¸">ğŸ‘ï¸ Ø±Ù…Ø¯</option><option value="ğŸ‘¶">ğŸ‘¶ Ø£Ø·ÙØ§Ù„</option>
                <option value="â¤ï¸">â¤ï¸ Ù‚Ù„Ø¨</option><option value="ğŸ‘¨â€âš•ï¸">ğŸ‘¨â€âš•ï¸ Ø£Ø·Ø¨Ø§Ø¡</option>
            </select>
            <button class="btn" style="background:var(--primary); color:white" id="catBtn" onclick="saveCategory()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù… âœ…</button>
        </div>

        <div class="admin-box">
            <h4>ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø© (ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ©)</h4>
            <input type="hidden" id="editDrId">
            <select id="drParent"></select>
            <input type="text" id="drName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±">
            <input type="file" id="drFile" accept="image/*">
            <div id="dynamicFields"></div>
            <button class="btn" style="background:#6366f1; color:white; font-size:12px; padding:8px;" onclick="addField()">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ù†Ø© (Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ ØªØ®ØµØµØŒ Ø³Ø¹Ø±..)</button>
            <input type="text" id="drWa" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø­Ø¬Ø²">
            <button class="btn" style="background:#10b981; color:white" id="drBtn" onclick="saveDoctor()">Ø­ÙØ¸ Ø§Ù„Ø¯ÙƒØªÙˆØ± âœ…</button>
        </div>

        <div class="admin-box">
            <h4>ğŸ“‹ Ø­Ø°Ù ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
            <input type="text" id="adminSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡..." oninput="syncAdminList()">
            <div id="manageList" style="margin-top:10px; max-height:200px; overflow-y:auto;"></div>
        </div>

        <button class="btn btn-close" onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>

    <div id="modal" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <img id="modalImg" src="" alt="Doctor">
                <h3 id="mTitle">Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±</h3>
            </div>
            <div class="modal-body" id="mInfo">
                </div>
            <div class="modal-footer">
                <a id="mWa" href="#" class="btn btn-wa" target="_blank">ğŸ’¬ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ ÙˆØ§ØªØ³Ø§Ø¨</a>
                <button class="btn btn-close" onclick="document.getElementById('modal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const config = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let dataStore = { cats: {}, drs: {} };
        let currentPath = ['root'];

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('hospital_final_v6').on('value', (s) => {
            dataStore = s.val() || { cats: {}, drs: {} };
            render();
            syncAdminUI();
        });

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ ---
        function render() {
            const grid = document.getElementById('mainGrid');
            const parent = currentPath[currentPath.length - 1];
            grid.innerHTML = '';
            document.getElementById('pathDisplay').innerText = currentPath.join(' > ').replace('root', 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
            document.getElementById('navButtons').style.display = currentPath.length > 1 ? 'block' : 'none';

            if(dataStore.cats) Object.values(dataStore.cats).forEach(c => {
                if(c.parent === parent) createCard(grid, c.icon || 'ğŸ“‚', c.name, () => { currentPath.push(c.name); render(); });
            });
            if(dataStore.drs) Object.values(dataStore.drs).forEach(dr => {
                if(dr.parent === parent) createCard(grid, 'ğŸ‘¨â€âš•ï¸', dr.name, () => showDr(dr));
            });
        }

        function createCard(container, icon, name, clickFn) {
            const d = document.createElement('div');
            d.className = 'card';
            d.innerHTML = `<div class="icon">${icon}</div><div class="name">${name}</div>`;
            d.onclick = clickFn;
            container.appendChild(d);
        }

        function handleSearch() {
            const q = document.getElementById('searchInput').value.trim().toLowerCase();
            const grid = document.getElementById('mainGrid');
            if(!q) { render(); return; }
            grid.innerHTML = '';
            Object.values(dataStore.cats || {}).forEach(c => { if(c.name.toLowerCase().includes(q)) createCard(grid, c.icon||'ğŸ“‚', c.name, () => { currentPath.push(c.name); render(); }); });
            Object.values(dataStore.drs || {}).forEach(d => { if(d.name.toLowerCase().includes(q)) createCard(grid, 'ğŸ‘¨â€âš•ï¸', d.name, () => showDr(d)); });
        }

        function goBack() { currentPath.pop(); render(); }

        // --- Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ù„ÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§) ---
        function showDr(dr) {
            document.getElementById('mTitle').innerText = dr.name;
            const img = document.getElementById('modalImg');
            // Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙˆØ±Ø© Ù†Ø­Ø· ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            img.src = dr.img || 'https://cdn-icons-png.flaticon.com/512/3774/3774299.png';
            
            let infoHtml = '';
            if(dr.fields) {
                dr.fields.forEach(f => {
                    infoHtml += `<div class="info-row"><b>${f.label}:</b> <span>${f.value}</span></div>`;
                });
            } else {
                infoHtml = '<p style="text-align:center; color:#94a3b8;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</p>';
            }
            
            document.getElementById('mInfo').innerHTML = infoHtml;
            document.getElementById('mWa').href = `https://wa.me/20${dr.wa}`;
            document.getElementById('modal').style.display = 'flex';
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù) ---
        function saveCategory() {
            const name = document.getElementById('catName').value, parent = document.getElementById('catParent').value, icon = document.getElementById('catIcon').value, id = document.getElementById('editCatId').value;
            if(!name) return;
            if(id) db.ref('hospital_final_v6/cats/'+id).update({name, parent, icon});
            else db.ref('hospital_final_v6/cats').push({name, parent, icon});
            document.getElementById('catName').value = ''; document.getElementById('editCatId').value = '';
        }

        async function saveDoctor() {
            const name = document.getElementById('drName').value, parent = document.getElementById('drParent').value, id = document.getElementById('editDrId').value, file = document.getElementById('drFile').files[0], wa = document.getElementById('drWa').value;
            let img = "";
            if(file) img = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });
            
            const fields = [];
            document.querySelectorAll('.f-row').forEach(row => {
                fields.push({ label: row.querySelector('.f-l').value, value: row.querySelector('.f-v').value });
            });

            const data = { name, parent, fields, wa };
            if(img) data.img = img;

            if(id) db.ref('hospital_final_v6/drs/'+id).update(data);
            else db.ref('hospital_final_v6/drs').push(data);
            
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
            resetDrForm();
        }

        function addField(l='', v='') {
            const div = document.createElement('div'); div.className = 'f-row'; div.style = "display:flex; gap:5px; margin-bottom:8px;";
            div.innerHTML = `<input type="text" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù† (Ù…Ø«Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)" class="f-l" value="${l}"> <input type="text" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" class="f-v" value="${v}"> <button onclick="this.parentElement.remove()" style="color:red; background:none; border:none;">X</button>`;
            document.getElementById('dynamicFields').appendChild(div);
        }

        function syncAdminUI() {
            const cp = document.getElementById('catParent'), dp = document.getElementById('drParent');
            let opts = '<option value="root">-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option>';
            if(dataStore.cats) Object.values(dataStore.cats).forEach(c => opts += `<option value="${c.name}">${c.name}</option>`);
            cp.innerHTML = opts; dp.innerHTML = opts;
            syncAdminList();
        }

        function syncAdminList() {
            const list = document.getElementById('manageList'), q = document.getElementById('adminSearch').value.toLowerCase();
            list.innerHTML = '';
            if(dataStore.cats) Object.entries(dataStore.cats).forEach(([id, c]) => {
                if(c.name.toLowerCase().includes(q)) list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee;"><span>ğŸ“‚ ${c.name}</span> <div><button onclick="editCat('${id}')" style="color:orange; border:none; background:none;">ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="del('cats','${id}')" style="color:red; border:none; background:none;">Ø­Ø°Ù</button></div></div>`;
            });
            if(dataStore.drs) Object.entries(dataStore.drs).forEach(([id, d]) => {
                if(d.name.toLowerCase().includes(q)) list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee;"><span>ğŸ‘¨â€âš•ï¸ ${d.name}</span> <div><button onclick="editDr('${id}')" style="color:orange; border:none; background:none;">ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="del('drs','${id}')" style="color:red; border:none; background:none;">Ø­Ø°Ù</button></div></div>`;
            });
        }

        function editCat(id) {
            const c = dataStore.cats[id];
            document.getElementById('editCatId').value = id;
            document.getElementById('catName').value = c.name;
            document.getElementById('catParent').value = c.parent;
            document.getElementById('catIcon').value = c.icon;
            document.getElementById('adminPanel').scrollTo(0,0);
        }

        function editDr(id) {
            const d = dataStore.drs[id];
            document.getElementById('editDrId').value = id;
            document.getElementById('drName').value = d.name;
            document.getElementById('drParent').value = d.parent;
            document.getElementById('drWa').value = d.wa;
            document.getElementById('dynamicFields').innerHTML = '';
            if(d.fields) d.fields.forEach(f => addField(f.label, f.value));
            document.getElementById('adminPanel').scrollTo(0,0);
        }

        function del(t, id) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) db.ref(`hospital_final_v6/${t}/${id}`).remove(); }
        function resetDrForm() { document.getElementById('editDrId').value=''; document.getElementById('drName').value=''; document.getElementById('dynamicFields').innerHTML=''; document.getElementById('drFile').value=''; }
        function openAdmin() { if(prompt("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:") === "1987") document.getElementById('adminPanel').style.display='block'; }
        function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    </script>
</body>
</html>
