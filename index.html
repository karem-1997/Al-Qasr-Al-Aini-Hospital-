<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0284c7; --bg: #f0f9ff; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; }
        
        .top-header { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); padding: 25px 20px; border-radius: 0 0 30px 30px; color: white; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .search-box { background: white; border-radius: 50px; display: flex; align-items: center; padding: 5px 15px; margin-top: 15px; max-width: 500px; margin-left: auto; margin-right: auto; }
        .search-box input { border: none; outline: none; width: 100%; padding: 10px; font-size: 14px; }

        .main-container { padding: 15px; margin-bottom: 80px; }
        #pathDisplay { font-size: 12px; color: var(--primary); font-weight: bold; margin-bottom: 15px; background: white; padding: 5px 12px; border-radius: 15px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ÙƒØ±ÙˆØª Ù„ØªØ±Ø¬Ø¹ ØµØºÙŠØ±Ø© ÙˆÙ…ØªÙ†Ø§Ø³Ù‚Ø© */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { 
            background: white; 
            padding: 15px 10px; 
            border-radius: 20px; 
            text-align: center; 
            cursor: pointer; 
            box-shadow: 0 4px 0 #cbd5e1; 
            border: 1px solid #e2e8f0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            transition: 0.1s; 
            min-height: 100px; /* Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø§Ù„Ù…ØªÙ†Ø§Ø³Ù‚ */
        }
        .card:active { transform: translateY(2px); box-shadow: none; }
        
        /* Ø¶Ø¨Ø· Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª */
        .card .icon-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; margin-bottom: 6px; border: 1px solid #eee; }
        .card .icon-emoji { font-size: 32px; margin-bottom: 6px; }
        .card .name { font-weight: bold; color: #0369a1; font-size: 13px; line-height: 1.2; }

        .footer-info { text-align: center; padding: 20px; color: #64748b; font-size: 13px; margin-top: 20px; border-top: 1px dashed #cbd5e1; }
        .fb-link { display: inline-block; margin-top: 10px; color: #1877f2; text-decoration: none; font-weight: bold; font-size: 18px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; z-index: 10001; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .admin-nav { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; }
        .nav-tab { padding: 8px 15px; background: #e2e8f0; border-radius: 50px; cursor: pointer; white-space: nowrap; font-weight: bold; font-size: 11px; }
        .nav-tab.active { background: var(--primary); color: white; }
        .admin-section { display: none; background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; }
        .admin-section.active { display: block; }

        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 13px; box-sizing: border-box; }
        .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; background: #f1f5f9; padding: 10px; border-radius: 12px; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 13px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-green { background: #10b981; color: white; }
        .btn-red { background: #ef4444; color: white; }

        .manage-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f1f5f9; background: #fff; margin-bottom: 6px; border-radius: 10px; }
        .item-actions { display: flex; gap: 10px; }
        .edit-btn { color: #f59e0b; font-weight: bold; cursor: pointer; font-size: 12px; }
        .delete-btn { color: #ef4444; font-weight: bold; cursor: pointer; font-size: 12px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 85%; max-width: 380px; border-radius: 30px; overflow: hidden; position: relative; }
        #modalImg { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); margin: 20px auto 10px; display: block; }
        #modalEmoji { font-size: 70px; text-align: center; margin-top: 15px; }
        .info-card { background: #f8fafc; padding: 10px; border-radius: 12px; margin: 6px 15px; border-right: 4px solid var(--primary); text-align: right; }

        .admin-trigger { position: fixed; bottom: 15px; left: 15px; width: 40px; height: 40px; opacity: 0.05; cursor: pointer; z-index: 10002; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 id="mainHeading" style="margin:0; font-size: 20px;">ØªØ­Ù…ÙŠÙ„...</h2>
        <div class="search-box">
            <span>ğŸ”</span>
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..." oninput="handleSearch()">
        </div>
    </div>

    <div class="main-container">
        <span id="pathDisplay">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        <div id="mainGrid" class="grid"></div>
        <button id="backBtn" class="btn" style="display:none; background:#64748b; color:white; margin-top:15px;" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
    </div>

    <div class="footer-info">
        <p id="footerText"></p>
        <a id="footerFb" href="#" target="_blank" class="fb-link" style="display:none;">ğŸ”µ Facebook</a>
    </div>

    <div class="admin-trigger" onclick="openAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <h3 style="text-align:center; color:var(--primary); margin-top:0;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
        
        <div class="admin-nav">
            <div class="nav-tab active" onclick="showSection('sec-settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            <div class="nav-tab" onclick="showSection('sec-add-cat')">ğŸ“¦ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
            <div class="nav-tab" onclick="showSection('sec-add-dr')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡/Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
            <div class="nav-tab" onclick="showSection('sec-manage')">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        </div>

        <div id="sec-settings" class="admin-section active">
            <input type="text" id="setMainTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰">
            <textarea id="setDesc" rows="2" placeholder="Ù†Øµ Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø¨Ø§Ù„Ø£Ø³ÙÙ„"></textarea>
            <input type="text" id="setFbUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ">
            <button class="btn btn-blue" onclick="saveSettings()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ğŸ”„</button>
        </div>

        <div id="sec-add-cat" class="admin-section">
            <input type="hidden" id="editCatId">
            <select id="catParent"><option value="root">-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option></select>
            <input type="text" id="catName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <select id="catIcon">
                <option value="ğŸ¥">ğŸ¥ Ù…Ø³ØªØ´ÙÙ‰</option><option value="ğŸ¢">ğŸ¢ Ø¹ÙŠØ§Ø¯Ø§Øª</option>
                <option value="ğŸ‘ï¸">ğŸ‘ï¸ Ø¹ÙŠÙˆÙ†</option><option value="ğŸ¦·">ğŸ¦· Ø£Ø³Ù†Ø§Ù†</option>
                <option value="ğŸ‘¶">ğŸ‘¶ Ø£Ø·ÙØ§Ù„</option><option value="â¤ï¸">â¤ï¸ Ù‚Ù„Ø¨</option>
                <option value="ğŸ¦´">ğŸ¦´ Ø¹Ø¸Ø§Ù…</option><option value="ğŸ”¬">ğŸ”¬ Ø£Ø´Ø¹Ø© / Ù…Ø¹Ø§Ù…Ù„</option>
                <option value="ğŸš‘">ğŸš‘ Ø·ÙˆØ§Ø±Ø¦</option>
            </select>
            <button class="btn btn-blue" onclick="saveCategory()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù… âœ…</button>
            <button class="btn btn-red" id="cancelCatEdit" style="display:none; margin-top:5px;" onclick="resetCatForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>

        <div id="sec-add-dr" class="admin-section">
            <input type="hidden" id="editDrId">
            <select id="drParent"></select>
            <input type="text" id="drName" placeholder="Ø§Ù„Ø§Ø³Ù… (Ø·Ø¨ÙŠØ¨ Ø£Ùˆ Ø®Ø¯Ù…Ø©)">
            <div style="background: #f1f5f9; padding: 8px; border-radius: 10px; margin-bottom: 8px;">
                <label style="font-size:11px;">ØµÙˆØ±Ø© Ù„ÙˆØ¬Ùˆ:</label>
                <input type="file" id="drFile" accept="image/*">
                <label style="font-size:11px;">Ø£Ùˆ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ:</label>
                <select id="drEmoji">
                    <option value="">-- Ø¨Ø¯ÙˆÙ† --</option>
                    <option value="ğŸ‘¨â€âš•ï¸">ğŸ‘¨â€âš•ï¸ Ø·Ø¨ÙŠØ¨</option><option value="ğŸ”¬">ğŸ”¬ Ø®Ø¯Ù…Ø©</option>
                    <option value="ğŸ©º">ğŸ©º Ø³Ù…Ø§Ø¹Ø©</option><option value="ğŸ’Š">ğŸ’Š Ø¯ÙˆØ§Ø¡</option>
                </select>
            </div>
            <div class="time-grid">
                <div><input type="text" id="tFrom" placeholder="Ù…Ù†"><select id="pFrom"><option>ØµØ¨Ø§Ø­Ø§Ù‹</option><option>Ù…Ø³Ø§Ø¡Ù‹</option></select></div>
                <div><input type="text" id="tTo" placeholder="Ø¥Ù„Ù‰"><select id="pTo"><option>Ù…Ø³Ø§Ø¡Ù‹</option><option>ØµØ¨Ø§Ø­Ø§Ù‹</option></select></div>
            </div>
            <input type="text" id="drLoc" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†">
            <div id="dynamicFields"></div>
            <button class="btn" style="background:#6366f1; color:white; font-size:11px; margin-bottom:8px" onclick="addField()">â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†</button>
            <input type="text" id="drWa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø­Ø¬Ø²">
            <button class="btn btn-green" onclick="saveDoctor()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>
            <button class="btn btn-red" id="cancelDrEdit" style="display:none; margin-top:5px;" onclick="resetDrForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>

        <div id="sec-manage" class="admin-section">
            <select id="filterSelect" onchange="syncAdminList()"></select>
            <div id="manageList" style="margin-top:10px; border-top: 1px solid #eee; padding-top:10px;"></div>
        </div>

        <button class="btn btn-red" style="margin-top:15px;" onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>

    <div id="modal" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="modalImg" src="" style="display:none;">
            <div id="modalEmoji" style="display: none;"></div>
            <h3 id="mTitle" style="text-align:center; margin:10px 0; color:#0369a1; font-size: 18px;"></h3>
            <div id="mInfo"></div>
            <div style="padding:12px; display:flex; flex-direction:column; gap:6px;">
                <a id="mLoc" href="#" class="btn btn-blue" style="text-decoration:none; display:none;" target="_blank">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
                <a id="mWa" href="#" class="btn btn-green" style="text-decoration:none;" target="_blank">ğŸ’¬ Ø­Ø¬Ø² / Ø§Ø³ØªÙØ³Ø§Ø±</a>
            </div>
        </div>
    </div>

    <script>
        const config = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        // ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ù†Ø§ Ù„ØªØµÙÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
        const DATA_PATH = 'hospital_v12_reset';

        let dataStore = { cats: {}, drs: {}, settings: {} };
        let currentPath = ['root'];

        db.ref(DATA_PATH).on('value', (s) => {
            dataStore = s.val() || { cats: {}, drs: {}, settings: {} };
            applySettings(); render(); syncAdminUI();
        });

        function applySettings() {
            const s = dataStore.settings || {};
            document.getElementById('mainHeading').innerText = s.title || "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ";
            document.getElementById('pageTitle').innerText = s.title || "Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ";
            document.getElementById('footerText').innerText = s.desc || "";
            const fb = document.getElementById('footerFb');
            if(s.fb) { fb.href = s.fb; fb.style.display = 'inline-block'; } else { fb.style.display = 'none'; }
        }

        function saveSettings() {
            db.ref(DATA_PATH + '/settings').set({
                title: document.getElementById('setMainTitle').value,
                desc: document.getElementById('setDesc').value,
                fb: document.getElementById('setFbUrl').value
            });
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!");
        }

        function showSection(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function render() {
            const grid = document.getElementById('mainGrid');
            const parent = currentPath[currentPath.length - 1];
            grid.innerHTML = '';
            document.getElementById('pathDisplay').innerText = currentPath.join(' > ').replace('root', 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
            document.getElementById('backBtn').style.display = currentPath.length > 1 ? 'block' : 'none';

            if(dataStore.cats) Object.values(dataStore.cats).forEach(c => {
                if(c.parent === parent) createCard(grid, c.icon || 'ğŸ“‚', c.name, () => { currentPath.push(c.name); render(); }, true);
            });
            if(dataStore.drs) Object.values(dataStore.drs).forEach(dr => {
                if(dr.parent === parent) createCard(grid, dr.emoji || '', dr.name, () => showDr(dr), false, dr.img);
            });
        }

        function createCard(container, icon, name, clickFn, isCat, imgUrl) {
            const d = document.createElement('div');
            d.className = 'card';
            let content = "";
            if(imgUrl) content = `<img src="${imgUrl}" class="icon-img">`;
            else if(icon) content = `<div class="${isCat ? 'icon-emoji' : 'icon-emoji'}">${icon}</div>`;
            d.innerHTML = `${content}<div class="name">${name}</div>`;
            d.onclick = clickFn;
            container.appendChild(d);
        }

        function showDr(dr) {
            document.getElementById('mTitle').innerText = dr.name;
            const mImg = document.getElementById('modalImg'), mEmo = document.getElementById('modalEmoji');
            if(dr.img) { mImg.src = dr.img; mImg.style.display = 'block'; mEmo.style.display = 'none'; }
            else if(dr.emoji) { mEmo.innerText = dr.emoji; mEmo.style.display = 'block'; mImg.style.display = 'none'; }
            else { mImg.style.display = 'none'; mEmo.style.display = 'none'; }
            let infoHtml = `<div class="info-card"><b>ğŸ•’ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</b><br><span>${dr.time}</span></div>`;
            if(dr.fields) dr.fields.forEach(f => infoHtml += `<div class="info-card"><b>${f.label}:</b><br><span>${f.value}</span></div>`);
            document.getElementById('mInfo').innerHTML = infoHtml;
            document.getElementById('mWa').href = `https://wa.me/20${dr.wa}`;
            const mLoc = document.getElementById('mLoc');
            if(dr.loc) { mLoc.href = dr.loc; mLoc.style.display = 'block'; } else { mLoc.style.display = 'none'; }
            document.getElementById('modal').style.display = 'flex';
        }

        function saveCategory() {
            const name = document.getElementById('catName').value, id = document.getElementById('editCatId').value;
            const data = { name, parent: document.getElementById('catParent').value, icon: document.getElementById('catIcon').value };
            if(!name) return;
            if(id) db.ref(DATA_PATH + '/cats/'+id).update(data);
            else db.ref(DATA_PATH + '/cats').push(data);
            resetCatForm();
        }

        async function saveDoctor() {
            const name = document.getElementById('drName').value, id = document.getElementById('editDrId').value, file = document.getElementById('drFile').files[0], emoji = document.getElementById('drEmoji').value;
            let img = ""; if(file) img = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });
            const fields = []; document.querySelectorAll('.f-row').forEach(row => fields.push({ label: row.querySelector('.f-l').value, value: row.querySelector('.f-v').value }));
            const timeStr = `Ù…Ù† ${document.getElementById('tFrom').value} ${document.getElementById('pFrom').value} Ø¥Ù„Ù‰ ${document.getElementById('tTo').value} ${document.getElementById('pTo').value}`;
            const data = { name, parent: document.getElementById('drParent').value, wa: document.getElementById('drWa').value, loc: document.getElementById('drLoc').value, time: timeStr, fields, emoji: emoji || "" };
            if(img) data.img = img; else if(id) data.img = dataStore.drs[id].img || "";
            if(id) db.ref(DATA_PATH + '/drs/'+id).set(data);
            else db.ref(DATA_PATH + '/drs').push(data);
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!"); resetDrForm();
        }

        function syncAdminUI() {
            const cp = document.getElementById('catParent'), dp = document.getElementById('drParent'), fs = document.getElementById('filterSelect');
            let opts = '<option value="root">-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option>';
            if(dataStore.cats) Object.values(dataStore.cats).forEach(c => opts += `<option value="${c.name}">${c.name}</option>`);
            cp.innerHTML = opts; dp.innerHTML = opts; fs.innerHTML = opts;
            syncAdminList();
        }

        function syncAdminList() {
            const list = document.getElementById('manageList'), f = document.getElementById('filterSelect').value;
            list.innerHTML = ''; 
            if(dataStore.cats) Object.entries(dataStore.cats).forEach(([id, c]) => {
                if(c.parent === f) list.innerHTML += `<div class="manage-item"><span>ğŸ“‚ ${c.name}</span> <div class="item-actions"><span class="edit-btn" onclick="editCat('${id}')">ØªØ¹Ø¯ÙŠÙ„</span> <span class="delete-btn" onclick="del('cats','${id}')">Ø­Ø°Ù</span></div></div>`;
            });
            if(dataStore.drs) Object.entries(dataStore.drs).forEach(([id, d]) => {
                if(d.parent === f) list.innerHTML += `<div class="manage-item"><span>ğŸ” ${d.name}</span> <div class="item-actions"><span class="edit-btn" onclick="editDr('${id}')">ØªØ¹Ø¯ÙŠÙ„</span> <span class="delete-btn" onclick="del('drs','${id}')">Ø­Ø°Ù</span></div></div>`;
            });
        }

        function editCat(id) {
            const c = dataStore.cats[id];
            document.getElementById('editCatId').value = id;
            document.getElementById('catName').value = c.name;
            document.getElementById('catParent').value = c.parent;
            document.getElementById('catIcon').value = c.icon;
            document.getElementById('cancelCatEdit').style.display = 'block';
            showSection('sec-add-cat');
        }

        function editDr(id) {
            const d = dataStore.drs[id];
            document.getElementById('editDrId').value = id;
            document.getElementById('drName').value = d.name;
            document.getElementById('drParent').value = d.parent;
            document.getElementById('drEmoji').value = d.emoji || "";
            document.getElementById('drWa').value = d.wa;
            document.getElementById('drLoc').value = d.loc || '';
            document.getElementById('cancelDrEdit').style.display = 'block';
            document.getElementById('dynamicFields').innerHTML = '';
            if(d.fields) d.fields.forEach(f => addField(f.label, f.value));
            showSection('sec-add-dr');
        }

        function del(t, id) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) db.ref(DATA_PATH + `/${t}/${id}`).remove(); }
        function addField(l='', v='') {
            const div = document.createElement('div'); div.className = 'f-row'; div.style = "display:flex; gap:5px; margin-bottom:5px;";
            div.innerHTML = `<input type="text" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†" class="f-l" value="${l}"> <input type="text" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" class="f-v" value="${v}">`;
            document.getElementById('dynamicFields').appendChild(div);
        }
        function resetCatForm() { document.getElementById('editCatId').value=''; document.getElementById('catName').value=''; document.getElementById('cancelCatEdit').style.display='none'; }
        function resetDrForm() { document.getElementById('editDrId').value=''; document.getElementById('drName').value=''; document.getElementById('cancelDrEdit').style.display='none'; document.getElementById('dynamicFields').innerHTML=''; }
        function handleSearch() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const grid = document.getElementById('mainGrid');
            if(!q) { render(); return; } grid.innerHTML = '';
            Object.values(dataStore.cats||{}).forEach(c => { if(c.name.toLowerCase().includes(q)) createCard(grid, c.icon||'ğŸ“‚', c.name, () => { currentPath.push(c.name); render(); }, true); });
            Object.values(dataStore.drs||{}).forEach(d => { if(d.name.toLowerCase().includes(q)) createCard(grid, d.emoji || '', d.name, () => showDr(d), false, d.img); });
        }
        function goBack() { currentPath.pop(); render(); }
        function openAdmin() { if(prompt("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:") === "1987") document.getElementById('adminPanel').style.display='block'; }
        function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    </script>
</body>
</html>
