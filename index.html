<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø°ÙƒÙŠ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0284c7; --bg: #f0f9ff; --card-bg: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; direction: rtl; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø± */
        .header { text-align: center; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        #pathDisplay { font-size: 14px; color: var(--primary); font-weight: bold; background: #e0f2fe; padding: 8px; border-radius: 10px; margin-top: 10px; display: inline-block; }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© - Ø¯ÙƒØ§ØªØ±Ø© Ø£Ùˆ Ø£Ù‚Ø³Ø§Ù… Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { 
            background: var(--card-bg); padding: 25px 10px; border-radius: 20px; text-align: center; 
            cursor: pointer; box-shadow: 0 5px 0 #bae6fd; transition: 0.1s; border: 1px solid #e0f2fe;
            display: flex; flex-direction: column; align-items: center; gap: 10px; font-weight: bold; color: #0369a1;
        }
        .card:active { transform: translateY(3px); box-shadow: 0 2px 0 #bae6fd; }
        .card.doctor { background: #f0f9ff; border: 1px dashed var(--primary); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; z-index: 9999; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .admin-box { background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #cbd5e1; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 10px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; margin-bottom: 10px; }
        .btn-add { background: var(--primary); }
        .btn-save { background: #10b981; }
        .btn-del { background: #ef4444; padding: 5px 10px; width: auto; font-size: 12px; }
        .btn-edit { background: #f59e0b; padding: 5px 10px; width: auto; font-size: 12px; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; }
        #modalImg { width: 100%; border-radius: 15px; max-height: 200px; object-fit: cover; margin-bottom: 15px; }

        .admin-btn { position: fixed; bottom: 15px; left: 15px; width: 45px; height: 45px; opacity: 0.2; cursor: pointer; z-index: 10001; }
        .item-list { font-size: 13px; border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0; color:#0369a1;">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ</h2>
        <div id="pathDisplay">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    </div>

    <div id="mainGrid" class="grid"></div>

    <div id="backBtnArea" style="display:none; margin-top:20px;">
        <button class="btn" style="background:#64748b" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
    </div>

    <div class="admin-btn" onclick="openAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <h2 style="text-align:center">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… "Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©"</h2>
        
        <div class="admin-box">
            <h4>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… (Ø±Ø¦ÙŠØ³ÙŠ Ø£Ùˆ ÙØ±Ø¹ÙŠ)</h4>
            <select id="catParentSelect"><option value="root">-- ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option></select>
            <input type="text" id="catNameInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª)">
            <button class="btn btn-add" onclick="addCategory()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù… âœ…</button>
        </div>

        <div class="admin-box">
            <h4>ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± (Ø¯Ø§Ø®Ù„ Ø£ÙŠ Ù‚Ø³Ù…)</h4>
            <select id="drParentSelect"></select>
            <input type="text" id="drNameInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±">
            <input type="file" id="drFile" accept="image/*">
            <input type="text" id="drTime" placeholder="Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ù…Ø«Ù„Ø§Ù‹: ÙŠÙˆÙ…ÙŠØ§Ù‹ 10 Øµ)">
            <input type="text" id="drWa" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
            <button class="btn btn-save" onclick="addDoctor()">Ø­ÙØ¸ Ø§Ù„Ø¯ÙƒØªÙˆØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… âœ…</button>
        </div>

        <div class="admin-box">
            <h4>ğŸ“‹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø­Ø°Ù</h4>
            <div id="adminList"></div>
        </div>

        <button class="btn" style="background:black" onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>

    <div id="detailsModal" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 id="mTitle" style="color:#0369a1;"></h2>
            <img id="modalImg">
            <div id="mInfo" style="text-align:right; background:#f0f9ff; padding:15px; border-radius:15px; margin-bottom:15px;"></div>
            <a id="mWa" class="btn btn-save" style="text-decoration:none; display:block; background:#25d366" target="_blank">ğŸ’¬ Ø­Ø¬Ø² ÙˆØ§ØªØ³Ø§Ø¨</a>
            <button class="btn" style="background:none; color:#64748b" onclick="document.getElementById('detailsModal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allData = { cats: {}, drs: {} };
        let currentPath = ['root']; // Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('tree_system').on('value', (snapshot) => {
            const data = snapshot.val() || { cats: {}, drs: {} };
            allData = data;
            render();
            updateSelects();
        });

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        function render() {
            const grid = document.getElementById('mainGrid');
            const parent = currentPath[currentPath.length - 1];
            grid.innerHTML = '';
            
            document.getElementById('pathDisplay').innerText = currentPath.join(' > ').replace('root', 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
            document.getElementById('backBtnArea').style.display = currentPath.length > 1 ? 'block' : 'none';

            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
            if(allData.cats) {
                Object.entries(allData.cats).forEach(([id, cat]) => {
                    if(cat.parent === parent) {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `<span style="font-size:30px">ğŸ“‚</span> ${cat.name}`;
                        div.onclick = () => { currentPath.push(cat.name); render(); };
                        grid.appendChild(div);
                    }
                });
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø© Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ† Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
            if(allData.drs) {
                Object.entries(allData.drs).forEach(([id, dr]) => {
                    if(dr.parent === parent) {
                        const div = document.createElement('div');
                        div.className = 'card doctor';
                        div.innerHTML = `<span style="font-size:30px">ğŸ‘¨â€âš•ï¸</span> ${dr.name}`;
                        div.onclick = () => showDoctor(dr);
                        grid.appendChild(div);
                    }
                });
            }
        }

        function goBack() { currentPath.pop(); render(); }

        // Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…
        function addCategory() {
            const name = document.getElementById('catNameInp').value;
            const parent = document.getElementById('catParentSelect').value;
            if(!name) return;
            db.ref('tree_system/cats').push({ name, parent });
            document.getElementById('catNameInp').value = '';
            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±
        async function addDoctor() {
            const name = document.getElementById('drNameInp').value;
            const parent = document.getElementById('drParentSelect').value;
            const file = document.getElementById('drFile').files[0];
            let img = "";
            if(file) img = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });

            if(!name || !parent) return alert("Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… ÙˆØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±");

            db.ref('tree_system/drs').push({
                name, parent, img,
                time: document.getElementById('drTime').value,
                wa: document.getElementById('drWa').value
            });
            alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù„Ù„Ù‚Ø³Ù…!");
            document.getElementById('drNameInp').value = '';
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙÙŠ Ø§Ù„ØªØ­ÙƒÙ…
        function updateSelects() {
            const cSel = document.getElementById('catParentSelect');
            const dSel = document.getElementById('drParentSelect');
            const list = document.getElementById('adminList');
            
            let options = '<option value="root">-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option>';
            if(allData.cats) {
                Object.values(allData.cats).forEach(c => options += `<option value="${c.name}">${c.name}</option>`);
            }
            cSel.innerHTML = options;
            dSel.innerHTML = options.replace('-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --', '-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --');

            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù
            list.innerHTML = '';
            if(allData.cats) {
                Object.entries(allData.cats).forEach(([id, c]) => {
                    list.innerHTML += `<div class="item-list">ğŸ“‚ ${c.name} (Ø¯Ø§Ø®Ù„ ${c.parent}) <button class="btn-del" onclick="deleteItem('cats','${id}')">Ø­Ø°Ù</button></div>`;
                });
            }
            if(allData.drs) {
                Object.entries(allData.drs).forEach(([id, d]) => {
                    list.innerHTML += `<div class="item-list">ğŸ‘¨â€âš•ï¸ ${d.name} (ÙÙŠ ${d.parent}) <button class="btn-del" onclick="deleteItem('drs','${id}')">Ø­Ø°Ù</button></div>`;
                });
            }
        }

        function deleteItem(type, id) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) db.ref(`tree_system/${type}/${id}`).remove(); }

        function showDoctor(dr) {
            document.getElementById('mTitle').innerText = dr.name;
            const img = document.getElementById('modalImg');
            if(dr.img) { img.src = dr.img; img.style.display = 'block'; } else { img.style.display = 'none'; }
            document.getElementById('mInfo').innerHTML = `<p><b>ğŸ•’ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</b> ${dr.time}</p>`;
            document.getElementById('mWa').href = `https://wa.me/20${dr.wa}`;
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function openAdmin() { if(prompt("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:") === "1987") document.getElementById('adminPanel').style.display='block'; }
        function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    </script>
</body>
</html>
