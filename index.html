<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title id="dynamicTitle">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙŠ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ</title>
    <meta property="og:title" id="ogTitle" content="Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙŠ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ">
    <meta property="og:description" content="Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø±Ø³Ù…ÙŠ - Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª ÙˆØ§Ù„Ø¯ÙƒØ§ØªØ±Ø©">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙŠ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0284c7; --bg: #f0f9ff; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; display: flex; flex-direction: column; min-height: 100vh; }
        
        .top-header { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); padding: 25px 20px; border-radius: 0 0 30px 30px; color: white; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .search-box { background: white; border-radius: 50px; display: flex; align-items: center; padding: 5px 15px; margin-top: 15px; max-width: 500px; margin-left: auto; margin-right: auto; }
        .search-box input { border: none; outline: none; width: 100%; padding: 10px; font-size: 14px; }

        .main-container { padding: 15px; flex: 1; margin-bottom: 20px; }
        #pathDisplay { font-size: 11px; color: var(--primary); font-weight: bold; margin-bottom: 15px; background: white; padding: 5px 12px; border-radius: 15px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; padding: 15px 10px; border-radius: 20px; text-align: center; cursor: pointer; box-shadow: 0 4px 0 #cbd5e1; border: 1px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.1s; min-height: 110px; position: relative; }
        .card:active { transform: translateY(2px); box-shadow: none; }
        .card .icon-img { width: 55px; height: 55px; border-radius: 50%; object-fit: cover; margin-bottom: 6px; border: 1px solid #eee; }
        .card .icon-emoji { font-size: 38px; margin-bottom: 6px; }
        .card .name { font-weight: bold; color: #0369a1; font-size: 13px; line-height: 1.2; }

        .admin-controls { display: none; position: absolute; top: 5px; left: 5px; right: 5px; justify-content: space-between; pointer-events: none; z-index: 5; }
        .admin-controls span { pointer-events: auto; background: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: pointer; }
        .btn-del { color: #ef4444; border: 1px solid #ef4444; }
        .btn-edit { color: #f59e0b; border: 1px solid #f59e0b; }
        
        .quick-add { display: none; background: #10b981; color: white; border-radius: 50px; padding: 10px; margin-bottom: 15px; text-align: center; font-weight: bold; cursor: pointer; }

        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; z-index: 10001; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .settings-tab { background: #e2e8f0; padding: 12px; border-radius: 12px; margin-bottom: 15px; cursor: pointer; font-weight: bold; color: #1e293b; text-align: center; }
        #settingsFields { display: none; background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #cbd5e1; margin-bottom: 20px; }

        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 14px; box-sizing: border-box; }
        
        .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; background: #f1f5f9; padding: 10px; border-radius: 12px; }
        .time-group { display: flex; gap: 4px; }
        
        .btn { padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-red { background: #ef4444; color: white; }
        .btn-green { background: #10b981; color: white; }
        
        .fb-float { position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; background: #1877f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 9999; text-decoration: none; transition: 0.3s; }
        .fb-float svg { width: 30px; height: 30px; fill: white; }

        footer { background: transparent; padding: 30px 20px; text-align: center; margin-top: auto; width: 100%; box-sizing: border-box; }
        .footer-dua { font-style: italic; color: #64748b; font-size: 15px; font-weight: 500; display: block; margin: 0 auto; max-width: 80%; line-height: 1.5; text-align: center; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 380px; border-radius: 30px; overflow: hidden; position: relative; padding-bottom: 20px; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.1); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #64748b; cursor: pointer; }

        .info-card { background: #f8fafc; padding: 10px; border-radius: 12px; margin: 6px 15px; border-right: 4px solid var(--primary); text-align: right; font-size: 14px; }
        .admin-trigger { position: fixed; bottom: 20px; left: 20px; width: 40px; height: 40px; opacity: 0.1; cursor: pointer; z-index: 10002; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 id="mainHeading">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙŠ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ</h2>
        <div class="search-box">
            <span>ğŸ”</span>
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..." oninput="handleSearch()">
        </div>
    </div>

    <div class="main-container">
        <div id="pathDisplay">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div id="quickAddBtn" class="quick-add" onclick="openQuickAdd()">â• Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­ØµØ±Ø§Ù‹</div>
        <div id="mainGrid" class="grid"></div>
        <button id="backBtn" class="btn btn-blue" style="display:none; background:#64748b; margin-top:15px; width:100%" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
    </div>

    <footer id="footerArea">
        <span class="footer-dua" id="footerDua">Ø§Ù„Ù„Ù‡Ù… Ø§Ø´ÙÙ ÙƒÙ„ Ù…Ø±ÙŠØ¶</span>
    </footer>

    <a href="#" id="fbLink" class="fb-float" target="_blank" style="display:none;">
        <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
    </a>

    <div class="admin-trigger" onclick="checkAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <div class="settings-tab" onclick="toggleSettings()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø© â¬‡ï¸</div>
        <div id="settingsFields">
            <input type="text" id="setMainTitle" placeholder="ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰">
            <textarea id="setDua" placeholder="Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©"></textarea>
            <input type="text" id="setFb" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ">
            <button class="btn btn-blue" style="width:100%" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ğŸ’¾</button>
        </div>
        <hr>
        <h3 id="panelTitle" style="text-align:center; color:var(--primary);">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯</h3>
        <select id="itemType" onchange="toggleFormType()">
            <option value="dr">Ø·Ø¨ÙŠØ¨ / Ø®Ø¯Ù…Ø© (ÙƒØ§Ø±Øª ØªÙØµÙŠÙ„ÙŠ)</option>
            <option value="cat">Ù‚Ø³Ù… / Ù…Ø¬Ù„Ø¯ (Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø·)</option>
        </select>
        <input type="text" id="itemName" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <div class="img-container">
            <input type="file" id="itemFile" accept="image/*">
            <button type="button" style="color:red" onclick="clearImageInput()">Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© ğŸ—‘ï¸</button>
        </div>
        <select id="commonIcon">
            <option value="ğŸ¥">ğŸ¥ Ù…Ø³ØªØ´ÙÙ‰</option><option value="ğŸ‘¨â€âš•ï¸">ğŸ‘¨â€âš•ï¸ Ø¯ÙƒØªÙˆØ±</option><option value="ğŸ‘©â€âš•ï¸">ğŸ‘©â€âš•ï¸ Ø¯ÙƒØªÙˆØ±Ø©</option>
            <option value="ğŸ¦·">ğŸ¦· Ø£Ø³Ù†Ø§Ù†</option><option value="ğŸ‘ï¸">ğŸ‘ï¸ Ø±Ù…Ø¯</option><option value="ğŸ¦´">ğŸ¦´ Ø¹Ø¸Ø§Ù…</option>
            <option value="ğŸ‘¶">ğŸ‘¶ Ø£Ø·ÙØ§Ù„</option><option value="â¤ï¸">â¤ï¸ Ù‚Ù„Ø¨</option><option value="ğŸ¢">ğŸ¢ Ù…Ø¨Ù†Ù‰</option>
        </select>
        <div id="drOnly">
            <div class="time-grid">
                <div class="time-group"><input type="text" id="tFrom" placeholder="Ù…Ù†"><select id="pFrom"><option>ØµØ¨Ø§Ø­Ø§Ù‹</option><option>Ù…Ø³Ø§Ø¡Ù‹</option></select></div>
                <div class="time-group"><input type="text" id="tTo" placeholder="Ø¥Ù„Ù‰"><select id="pTo"><option>Ù…Ø³Ø§Ø¡Ù‹</option><option>ØµØ¨Ø§Ø­Ø§Ù‹</option></select></div>
            </div>
            <input type="text" id="drWa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨">
            <input type="text" id="drLoc" placeholder="Ø¬ÙˆØ¬Ù„ Ù…Ø§Ø¨">
            <div id="dynamicFields"></div>
            <button class="btn" style="background:#6366f1; color:white; width:100%" onclick="addField()">â• Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <input type="hidden" id="editId"><input type="hidden" id="editTypeRef">
        <button class="btn btn-green" style="width:100%; margin-top:10px;" onclick="saveData()">Ø­ÙØ¸ âœ…</button>
        <button class="btn btn-red" style="width:100%; margin-top:5px;" onclick="closeAdmin()">Ø¥Ù„ØºØ§Ø¡ âŒ</button>
    </div>

    <div id="modal" class="modal" onclick="closeDrModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="close-modal" onclick="closeDrModal()">âœ•</div>
            <div id="modalEmojiHeader" style="font-size:55px; text-align:center; margin-top:30px;"></div>
            <img id="modalImg" src="" style="width:110px; height:110px; border-radius:50%; margin:30px auto 10px; display:none; object-fit:cover; border:4px solid var(--primary);">
            <h3 id="mTitle" style="text-align:center; color:#0369a1;"></h3>
            <div id="mInfo"></div>
            <div class="modal-actions" style="display:flex; gap:10px; padding:15px;">
                <a id="mLoc" href="#" class="btn btn-blue" style="flex:1" target="_blank">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
                <a id="mWa" href="#" class="btn btn-green" style="flex:1" target="_blank">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
            </div>
        </div>
    </div>

    <script>
        const config = { apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0", databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(config);
        const db = firebase.database();
        const DATA_PATH = 'hospital_extreme_isolation_v1';

        let dataStore = { cats: {}, drs: {}, settings: {} };
        let currentPathNodes = [{ id: 'root', name: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' }]; 
        let isAdminMode = false;
        let currentImgBase64 = "";

        db.ref(DATA_PATH).on('value', (s) => {
            dataStore = s.val() || { cats: {}, drs: {}, settings: {} };
            render();
            updateGlobalSettings();
        });

        function updateGlobalSettings() { 
            const s = dataStore.settings || {}; 
            // Ø¬Ø¹Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡ Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            const finalTitle = s.title || "Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙŠ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ";
            
            document.getElementById('mainHeading').innerText = finalTitle; 
            document.title = finalTitle; 
            document.getElementById('dynamicTitle').innerText = finalTitle;
            document.getElementById('ogTitle').setAttribute('content', finalTitle);
            
            document.getElementById('footerDua').innerText = s.dua || "Ø§Ù„Ù„Ù‡Ù… Ø§Ø´ÙÙ ÙƒÙ„ Ù…Ø±ÙŠØ¶"; 
            const fb = document.getElementById('fbLink'); 
            if(s.fb) { fb.href = s.fb; fb.style.display = 'flex'; } else { fb.style.display = 'none'; } 
        }

        // --- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø§Ù„Ø¹Ø²Ù„ØŒ Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯) Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø§Ù„Ø­Ø±Ù ---
        function render() {
            const grid = document.getElementById('mainGrid');
            const parentID = currentPathNodes[currentPathNodes.length - 1].id;
            grid.innerHTML = '';
            document.getElementById('pathDisplay').innerText = currentPathNodes.map(n => n.name).join(' > ');
            document.getElementById('backBtn').style.display = currentPathNodes.length > 1 ? 'block' : 'none';
            document.getElementById('quickAddBtn').style.display = isAdminMode ? 'block' : 'none';
            if(dataStore.cats) { Object.entries(dataStore.cats).forEach(([id, c]) => { if(c.parentId === parentID) createCard(grid, id, c.icon, c.name, () => { currentPathNodes.push({id: id, name: c.name}); render(); }, 'cats', c.img); }); }
            if(dataStore.drs) { Object.entries(dataStore.drs).forEach(([id, d]) => { if(d.parentId === parentID) createCard(grid, id, d.icon, d.name, () => showDr(d), 'drs', d.img); }); }
        }
        function createCard(container, id, icon, name, clickFn, type, imgUrl) {
            const d = document.createElement('div'); d.className = 'card';
            let content = imgUrl ? `<img src="${imgUrl}" class="icon-img">` : `<div class="icon-emoji">${icon}</div>`;
            let controls = isAdminMode ? `<div class="admin-controls" style="display:flex;"><span class="btn-edit" onclick="event.stopPropagation(); startEdit('${type}', '${id}')">âœï¸</span><span class="btn-del" onclick="event.stopPropagation(); deleteItem('${type}', '${id}')">âŒ</span></div>` : '';
            d.innerHTML = `${controls}${content}<div class="name">${name}</div>`;
            d.onclick = clickFn;
            container.appendChild(d);
        }
        async function saveData() {
            const id = document.getElementById('editId').value;
            const typeRef = document.getElementById('editTypeRef').value;
            const newType = document.getElementById('itemType').value === 'cat' ? 'cats' : 'drs';
            const name = document.getElementById('itemName').value;
            if(!name) return;
            const parentID = currentPathNodes[currentPathNodes.length - 1].id;
            let data = { name, parentId: parentID, icon: document.getElementById('commonIcon').value, img: currentImgBase64 };
            if(newType === 'drs') {
                data.time = `Ù…Ù† ${document.getElementById('tFrom').value} ${document.getElementById('pFrom').value} Ø¥Ù„Ù‰ ${document.getElementById('tTo').value} ${document.getElementById('pTo').value}`;
                data.wa = document.getElementById('drWa').value; data.loc = document.getElementById('drLoc').value;
                const flds = []; document.querySelectorAll('.f-row').forEach(row => { const l = row.querySelector('.f-l').value; const v = row.querySelector('.f-v').value; if(l && v) flds.push({ label: l, value: v }); });
                data.fields = flds;
            }
            if(id) { if(typeRef && typeRef !== newType) db.ref(`${DATA_PATH}/${typeRef}/${id}`).remove(); db.ref(`${DATA_PATH}/${newType}/${id}`).update(data); }
            else { db.ref(`${DATA_PATH}/${newType}`).push(data); }
            closeAdmin();
        }
        function goBack() { if(currentPathNodes.length > 1) { currentPathNodes.pop(); render(); } }
        function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:") === "1987") { isAdminMode = true; render(); } }
        function toggleSettings() { const f = document.getElementById('settingsFields'); f.style.display = f.style.display === 'block' ? 'none' : 'block'; }
        function saveSettings() { const s = { title: document.getElementById('setMainTitle').value, dua: document.getElementById('setDua').value, fb: document.getElementById('setFb').value }; db.ref(`${DATA_PATH}/settings`).set(s).then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!"); toggleSettings(); }); }
        function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; resetForm(); }
        function resetForm() { document.getElementById('editId').value = ""; document.getElementById('editTypeRef').value = ""; document.getElementById('itemName').value = ""; document.getElementById('itemFile').value = ""; currentImgBase64 = ""; document.getElementById('tFrom').value = ""; document.getElementById('tTo').value = ""; document.getElementById('drWa').value = ""; document.getElementById('drLoc').value = ""; document.getElementById('dynamicFields').innerHTML = ""; }
        function toggleFormType() { document.getElementById('drOnly').style.display = document.getElementById('itemType').value === 'dr' ? 'block' : 'none'; }
        function openQuickAdd() { resetForm(); document.getElementById('adminPanel').style.display = 'block'; }
        function clearImageInput() { document.getElementById('itemFile').value = ""; currentImgBase64 = ""; }
        function deleteItem(type, id) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) db.ref(`${DATA_PATH}/${type}/${id}`).remove(); }
        function closeDrModal() { document.getElementById('modal').style.display = 'none'; }
        function addField(l = '', v = '') { const div = document.createElement('div'); div.className = 'f-row'; div.innerHTML = `<input type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="f-l" value="${l}" style="width:40%"> <input type="text" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" class="f-v" value="${v}" style="width:50%"> <button onclick="this.parentElement.remove()" style="color:red; background:none; border:none;">âœ•</button>`; document.getElementById('dynamicFields').appendChild(div); }
        document.getElementById('itemFile').addEventListener('change', function(e) { const file = e.target.files; if(file) { const rd = new FileReader(); rd.onload = (ev) => { currentImgBase64 = ev.target.result; }; rd.readAsDataURL(file); } });
        function showDr(dr) {
            document.getElementById('mTitle').innerText = dr.name; const mImg = document.getElementById('modalImg'); const mEmoji = document.getElementById('modalEmojiHeader');
            if(dr.img) { mImg.src = dr.img; mImg.style.display = 'block'; mEmoji.style.display = 'none'; } else { mEmoji.innerText = dr.icon || 'ğŸ‘¨â€âš•ï¸'; mEmoji.style.display = 'block'; mImg.style.display = 'none'; }
            let infoHtml = `<div class="info-card"><b>ğŸ•’ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</b><br>${dr.time}</div>`;
            if(dr.fields) dr.fields.forEach(f => infoHtml += `<div class="info-card"><b>${f.label}:</b><br>${f.value}</div>`);
            document.getElementById('mInfo').innerHTML = infoHtml; document.getElementById('mWa').href = "https://wa.me/20" + dr.wa;
            const mLoc = document.getElementById('mLoc'); if(dr.loc) { mLoc.href = dr.loc; mLoc.style.display = 'block'; } else { mLoc.style.display = 'none'; }
            document.getElementById('modal').style.display = 'flex';
        }
        function handleSearch() {
            const q = document.getElementById('searchInput').value.toLowerCase(); const grid = document.getElementById('mainGrid'); if(!q) { render(); return; } grid.innerHTML = '';
            Object.entries(dataStore.cats||{}).forEach(([id, c]) => { if(c.name.toLowerCase().includes(q)) createCard(grid, id, c.icon, c.name, () => { currentPathNodes.push({id: id, name: c.name}); render(); }, 'cats', c.img); });
            Object.entries(dataStore.drs||{}).forEach(([id, d]) => { if(d.name.toLowerCase().includes(q)) createCard(grid, id, d.icon, d.name, () => showDr(d), 'drs', d.img); });
        }
    </script>
</body>
</html>
