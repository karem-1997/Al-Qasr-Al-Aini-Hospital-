<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0284c7; --bg: #f0f9ff; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; }
        
        .top-header { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); padding: 25px 20px; border-radius: 0 0 30px 30px; color: white; text-align: center; }
        .main-container { padding: 15px; margin-bottom: 80px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { 
            background: white; padding: 15px 10px; border-radius: 20px; text-align: center; 
            box-shadow: 0 4px 0 #cbd5e1; border: 1px solid #e2e8f0; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100px;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; z-index: 10001; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .admin-nav { display: flex; gap: 8px; margin-bottom: 15px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        .nav-tab { padding: 8px 15px; background: #e2e8f0; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 11px; }
        .nav-tab.active { background: var(--primary); color: white; }
        .admin-section { display: none; background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; }
        .admin-section.active { display: block; }

        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-red { background: #ef4444; color: white; }
        .btn-blue { background: var(--primary); color: white; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø­Ø°Ù */
        .manage-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; background: #fff; border: 1px solid #edf2f7; 
            border-radius: 12px; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .del-link { color: #ef4444; font-weight: bold; cursor: pointer; padding: 5px 10px; border: 1px solid #fed7d7; border-radius: 8px; background: #fff5f5; }
        .del-link:hover { background: #feb2b2; color: #fff; }

        .admin-trigger { position: fixed; bottom: 15px; left: 15px; width: 40px; height: 40px; opacity: 0.1; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 id="mainHeading">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
    </div>

    <div class="main-container">
        <div id="mainGrid" class="grid"></div>
    </div>

    <div class="admin-trigger" onclick="openAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <div class="admin-nav">
            <div class="nav-tab active" onclick="showSection('sec-add')">â• Ø¥Ø¶Ø§ÙØ©</div>
            <div class="nav-tab" onclick="showSection('sec-manage')">ğŸ—‘ï¸ Ø­Ø°Ù ÙˆØ¥Ø¯Ø§Ø±Ø©</div>
        </div>

        <div id="sec-add" class="admin-section active">
            <h4>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø£Ùˆ Ø®Ø¯Ù…Ø©</h4>
            <select id="targetType">
                <option value="cats">Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª)</option>
                <option value="drs">Ø·Ø¨ÙŠØ¨ Ø£Ùˆ Ø®Ø¯Ù…Ø© (Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù…)</option>
            </select>
            <select id="parentSelect"><option value="root">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option></select>
            <input type="text" id="itemName" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <button class="btn btn-blue" onclick="addItem()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>
        </div>

        <div id="sec-manage" class="admin-section">
            <h4 style="color: #ef4444;">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</h4>
            <p style="font-size: 11px; color: #718096;">* Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø­Ø°Ù Ø³ÙŠØ®ØªÙÙŠ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ù† ØªØ³ØªØ·ÙŠØ¹ Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡.</p>
            <div id="fullManageList"></div>
        </div>

        <button class="btn btn-red" onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>

    <script>
        const config = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(config);
        const db = firebase.database();
        const DB_PATH = 'hospital_v11_clean'; // Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

        let dataStore = { cats: {}, drs: {} };

        db.ref(DB_PATH).on('value', (s) => {
            dataStore = s.val() || { cats: {}, drs: {} };
            render();
            syncManageList();
        });

        function render() {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';
            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙƒÙ…Ø«Ø§Ù„
            if(dataStore.cats) Object.values(dataStore.cats).forEach(c => {
                grid.innerHTML += `<div class="card"><div>ğŸ“‚</div><b>${c.name}</b></div>`;
            });
        }

        function addItem() {
            const type = document.getElementById('targetType').value;
            const name = document.getElementById('itemName').value;
            const parent = document.getElementById('parentSelect').value;
            if(!name) return;

            db.ref(`${DB_PATH}/${type}`).push({ name, parent });
            document.getElementById('itemName').value = '';
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
        function deleteNow(type, id) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©ØŸ")) {
                db.ref(`${DB_PATH}/${type}/${id}`).remove()
                .then(() => {
                    alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                })
                .catch((error) => {
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + error.message);
                });
            }
        }

        function syncManageList() {
            const list = document.getElementById('fullManageList');
            const parentSel = document.getElementById('parentSelect');
            list.innerHTML = '';
            let opts = '<option value="root">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>';

            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ù„Ø­Ø°Ù
            if(dataStore.cats) {
                Object.entries(dataStore.cats).forEach(([id, c]) => {
                    list.innerHTML += `
                        <div class="manage-item">
                            <span>ğŸ“‚ Ø§Ù„Ù‚Ø³Ù…: <b>${c.name}</b></span>
                            <span class="del-link" onclick="deleteNow('cats', '${id}')">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ ğŸ—‘ï¸</span>
                        </div>`;
                    opts += `<option value="${c.name}">${c.name}</option>`;
                });
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©/Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„Ù„Ø­Ø°Ù
            if(dataStore.drs) {
                Object.entries(dataStore.drs).forEach(([id, d]) => {
                    list.innerHTML += `
                        <div class="manage-item">
                            <span>ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø®Ø¯Ù…Ø©: <b>${d.name}</b></span>
                            <span class="del-link" onclick="deleteNow('drs', '${id}')">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ ğŸ—‘ï¸</span>
                        </div>`;
                });
            }
            parentSel.innerHTML = opts;
        }

        function showSection(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function openAdmin() { if(prompt("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:") === "1987") document.getElementById('adminPanel').style.display='block'; }
        function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    </script>
</body>
</html>
