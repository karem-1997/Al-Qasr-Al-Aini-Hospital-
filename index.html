<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { 
            --accent: #0284c7; 
            --bg-gradient: linear-gradient(135deg, #e0f2fe 0%, #7dd3fc 100%);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg-gradient); background-attachment: fixed; 
            margin: 0; padding: 15px; color: #0c4a6e; min-height: 100vh;
        }

        .header-area {
            text-align: center; padding: 20px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px); border-radius: 20px;
            margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.4);
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± - Ù†Ø¸Ø§Ù… 2 ÙÙŠ ÙƒÙ„ ØµÙ */
        .grid-container { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; 
        }

        .main-btn { 
            background: white; border: 1px solid #bae6fd; padding: 25px 10px; 
            border-radius: 20px; cursor: pointer; font-weight: 800; 
            color: #0369a1; box-shadow: 0 5px 0 #38bdf8, 0 8px 12px rgba(0,0,0,0.1);
            transition: 0.1s; font-size: 14px; text-align: center;
        }
        .main-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #38bdf8; }

        .back-nav { margin-top: 25px; }
        .back-btn { background: #64748b; color: white; border: none; padding: 12px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: bold; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f1f5f9; z-index: 10001; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .admin-section { background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 10px; }
        .btn-save { background: #10b981; color: white; padding: 12px; border-radius: 10px; width: 100%; border: none; font-weight: bold; cursor: pointer; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 20px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; }
        #modalImg { width: 100%; border-radius: 15px; max-height: 200px; object-fit: cover; margin-bottom: 15px; }
        
        .admin-trigger { position: fixed; bottom: 10px; right: 10px; width: 40px; height: 40px; opacity: 0.05; cursor: pointer; z-index: 9999; }
    </style>
</head>
<body>

    <div class="header-area">
        <h1 id="mainHeading">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØ± Ø§Ù„ÙØ±Ù†Ø³ÙŠ</h1>
        <p id="breadCrumb" style="font-size: 12px; color: var(--accent); font-weight: bold;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
    </div>

    <div id="appContainer" class="grid-container"></div>

    <div id="navArea" class="back-nav" style="display:none;">
        <button class="back-btn" onclick="goBack()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ø§Ø¨Ù‚</button>
    </div>

    <div class="admin-trigger" onclick="checkAdmin()">âš™ï¸</div>

    <div id="adminPanel">
        <h2 style="text-align:center;">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</h2>
        
        <div class="admin-section">
            <h4>1. Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… (Ø±Ø¦ÙŠØ³ÙŠ Ø£Ùˆ ÙØ±Ø¹ÙŠ)</h4>
            <select id="parentLevelSelect"><option value="root">-- Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ Ø¬Ø¯ÙŠØ¯ --</option></select>
            <input type="text" id="catNameInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¨Ø§Ø·Ù†Ø©)">
            <button class="btn-save" onclick="saveCategory()" style="background:#0369a1;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù… âœ…</button>
        </div>

        <div class="admin-section">
            <h4 id="formTitle">2. Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±/Ø¨ÙŠØ§Ù†Ø§Øª (Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ)</h4>
            <select id="finalCatSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ Ø£ÙˆÙ„Ø§Ù‹</option></select>
            <input type="text" id="drName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±">
            <input type="file" id="imgFile" accept="image/*">
            <input type="text" id="drTime" placeholder="Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ù…Ù† 10 Øµ Ø¥Ù„Ù‰ 2 Ø¸)">
            <input type="text" id="drMap" placeholder="Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ù…Ø§Ø¨">
            <input type="text" id="drWa" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
            <button class="btn-save" onclick="saveData()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>
        </div>

        <button class="btn-save" style="background:#ef4444; margin-top:10px;" onclick="location.reload()">âŒ Ø®Ø±ÙˆØ¬ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</button>
        <div id="manageList" style="margin-top:20px; font-size:12px;"></div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <img id="modalImg">
            <div id="modalInfo" style="text-align: right; background: #f0f9ff; padding: 15px; border-radius: 15px; margin-bottom: 10px;"></div>
            <a id="modalMap" style="display:none; background:#0ea5e9; color:white; text-decoration:none; padding:12px; border-radius:15px; display:block; margin-bottom:10px; font-weight:bold;" target="_blank">ğŸ“ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
            <a id="modalWa" style="background:#25d366; color:white; text-decoration:none; padding:12px; border-radius:15px; display:block; font-weight:bold;" target="_blank">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
            <button onclick="closeModal()" style="margin-top:15px; border:none; background:none; color:#64748b; font-weight:bold; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDpRvNYUZhsaAUlwk4_n94KNgK50rhfD-0",
            databaseURL: "https://al-qasr-hospital-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();

        let categories = {};
        let items = {};
        let history = ['root'];

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        rdb.ref('global_cats').on('value', s => { categories = s.val() || {}; renderApp(); updateSelectors(); });
        rdb.ref('global_items').on('value', s => { items = s.val() || {}; renderApp(); });

        function renderApp() {
            const currentLevel = history[history.length - 1];
            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø±
            document.getElementById('breadCrumb').innerText = history.join(' > ');
            document.getElementById('navArea').style.display = history.length > 1 ? 'block' : 'none';

            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            Object.keys(categories).forEach(id => {
                if (categories[id].parent === currentLevel) {
                    const b = document.createElement('button');
                    b.className = 'main-btn';
                    b.innerHTML = `ğŸ“‚<br>${categories[id].name}`;
                    b.onclick = () => { history.push(categories[id].name); renderApp(); };
                    container.appendChild(b);
                }
            });

            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡/Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            Object.keys(items).forEach(id => {
                if (items[id].parent === currentLevel) {
                    const b = document.createElement('button');
                    b.className = 'main-btn';
                    b.style.background = 'linear-gradient(to bottom, #ffffff, #e0f2fe)';
                    b.innerHTML = `ğŸ‘¤<br>${items[id].name}`;
                    b.onclick = () => showDetails(items[id]);
                    container.appendChild(b);
                }
            });
        }

        function goBack() { if(history.length > 1) { history.pop(); renderApp(); } }

        function showDetails(d) {
            document.getElementById('modalTitle').innerText = d.name;
            const im = document.getElementById('modalImg');
            if(d.img) { im.src = d.img; im.style.display = 'block'; } else { im.style.display = 'none'; }
            document.getElementById('modalInfo').innerHTML = `<p>â° <b>Ø§Ù„Ù…ÙˆØ¹Ø¯:</b> ${d.time}</p>`;
            const m = document.getElementById('modalMap');
            if(d.map) { m.href = d.map; m.style.display = 'block'; } else { m.style.display = 'none'; }
            document.getElementById('modalWa').href = `https://wa.me/20${d.wa}`;
            document.getElementById('detailModal').style.display = 'flex';
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function saveCategory() {
            const name = document.getElementById('catNameInp').value;
            const parent = document.getElementById('parentLevelSelect').value;
            if(name) {
                rdb.ref('global_cats').push({ name, parent });
                document.getElementById('catNameInp').value = '';
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­");
            }
        }

        async function saveData() {
            const parent = document.getElementById('finalCatSelect').value;
            const name = document.getElementById('drName').value;
            const file = document.getElementById('imgFile').files[0];
            let imgBase64 = "";
            if (file) imgBase64 = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });

            if(name && parent) {
                rdb.ref('global_items').push({
                    name, parent, time: document.getElementById('drTime').value,
                    map: document.getElementById('drMap').value,
                    wa: document.getElementById('drWa').value,
                    img: imgBase64
                });
                alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
            }
        }

        function updateSelectors() {
            const pSel = document.getElementById('parentLevelSelect');
            const fSel = document.getElementById('finalCatSelect');
            let options = '<option value="root">-- Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ Ø¬Ø¯ÙŠØ¯ --</option>';
            let fOptions = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</option>';
            
            Object.values(categories).forEach(c => {
                options += `<option value="${c.name}">${c.name}</option>`;
                fOptions += `<option value="${c.name}">${c.name}</option>`;
            });
            pSel.innerHTML = options;
            fSel.innerHTML = fOptions;
        }

        function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "1987") document.getElementById('adminPanel').style.display = 'block'; }
        function closeModal() { document.getElementById('detailModal').style.display = 'none'; }
    </script>
</body>
</html>
